<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liminal Existence</title>
  <!-- Google Font: Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* Reset and base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { width: 100%; height: 100%; overflow: hidden; font-family: 'Roboto', sans-serif; color: #333; }
    .container { display: flex; align-items: center; justify-content: center; width: 100vw; height: 100vh; }
    /* Intro */
    #intro { text-align: left; max-width: 40%; line-height: 1.5; }
    #intro p { margin-bottom: 1em; }
    #intro .arrow { display: inline-block; margin-top: 1em; font-size: 2rem; cursor: pointer; }
    /* Back arrow */
    #back { position: absolute; top: 1rem; left: 1rem; font-size: 1.5rem; cursor: pointer; color: #aaa; }
    /* Wheel view */
    #wheel, #space { display: none; position: relative; }
    #wheel svg { width: 50vw; height: 50vw; }
    #wheel path { fill: #eee; stroke: #ccc; cursor: pointer; }
    #wheel path:hover { fill: #ddd; }
    #wheel text { fill: #666; font-size: 1rem; cursor: pointer; pointer-events: none; }
    /* Space view */
    #space > #space-area { position: relative; width: 60vw; height: 60vw; }
    #space svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    .dot { position: absolute; width: 10px; height: 10px; border-radius: 50%; }
  </style>
</head>
<body>
  <!-- Intro -->
  <div id="intro" class="container">
    <div>
      <p>Hey Friend,<br>
      To get you started, this ‘dot’ represents You.</p>
      <p>The circumference is the liminal space between what’s happening in your life, and what comes next.</p>
      <p>This is a place of pause. Something in between.</p>
      <p>You may hang out here for as long as you need.</p>
      <p>From time to time, you will see other souls appear within the circle. These individuals are in the same boat as you. They may be strangers, but you are not alone.</p>
      <p>This is not a place where you need words to feel each other. This is a place of companionship through resonance alone.</p>
      <p>You see, we may not always understand each other, but we’re all the same.</p>
      <p>And I hope you find solace here, knowing at least one other person, ‘Me’, has been where you are at. This is why I made this space. Because I was alone in mine, but not really. I just didn’t know others felt the same way. I hope for you, it will be more apparent.</p>
      <div class="arrow" onclick="showWheel()">→</div>
    </div>
  </div>

  <!-- Wheel -->
  <div id="wheel" class="container">
    <div id="back" onclick="resetToIntro()">←</div>
    <svg viewBox="0 0 400 400">
      <g transform="translate(200,200)"></g>
    </svg>
  </div>

  <!-- Space -->
  <div id="space" class="container">
    <div id="back" onclick="goBackToWheel()">←</div>
    <div id="space-area">
      <svg viewBox="0 0 400 400">
        <circle cx="200" cy="200" r="190" fill="none" stroke="#ccc" stroke-width="2" />
      </svg>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyAyojhlJalsVqfTiXsukMr22Wlw06K6MEQ",
      authDomain: "liminal-space-b9701.firebaseapp.com",
      databaseURL: "https://liminal-space-b9701-default-rtdb.firebaseio.com",
      projectId: "liminal-space-b9701",
      storageBucket: "liminal-space-b9701.firebasestorage.app",
      messagingSenderId: "84406710181",
      appId: "1:84406710181:web:a171d7364a0a0d34e1024c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // State
    const emotions = ['sad','angry','disgusted','happy','surprised','bad','fearful'];
    let userId = Math.random().toString(36).substr(2,9);
    let selectedEmotion = null;
    let presenceRef;

    // Elements
    const introEl = document.getElementById('intro');
    const wheelEl = document.getElementById('wheel');
    const spaceEl = document.getElementById('space');
    const wheelGroup = wheelEl.querySelector('g');
    const spaceArea = document.getElementById('space-area');

    // Show intro
    function resetToIntro() {
      if(presenceRef) presenceRef.remove();
      spaceEl.style.display = 'none';
      wheelEl.style.display = 'none';
      introEl.style.display = 'flex';
    }
    // Show wheel
    function showWheel() {
      introEl.style.display = 'none';
      spaceEl.style.display = 'none';
      wheelEl.style.display = 'flex';
      drawWheel();
    }
    // Go back to wheel
    function goBackToWheel() {
      if(presenceRef) presenceRef.remove();
      spaceEl.style.display = 'none';
      wheelEl.style.display = 'flex';
    }

    // Draw wheel
    function drawWheel(){
      wheelGroup.innerHTML = '';
      const slice = 360 / emotions.length;
      emotions.forEach((emo,i) => {
        const angle = slice * i;
        const rad = Math.PI/180;
        const x1 = Math.cos(rad*angle)*200;
        const y1 = Math.sin(rad*angle)*200;
        const x2 = Math.cos(rad*(angle+slice))*200;
        const y2 = Math.sin(rad*(angle+slice))*200;
        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        path.setAttribute('d', `M0,0 L${x1},${y1} A200,200 0 0,1 ${x2},${y2} Z`);
        path.onclick = () => selectEmotion(emo);
        wheelGroup.appendChild(path);

        const mid = angle + slice/2;
        const tx = Math.cos(rad*mid)*120;
        const ty = Math.sin(rad*mid)*120;
        const text = document.createElementNS('http://www.w3.org/2000/svg','text');
        text.setAttribute('x', tx);
        text.setAttribute('y', ty+5);
        text.textContent = emo.charAt(0).toUpperCase() + emo.slice(1);
        text.style.pointerEvents = 'none';
        wheelGroup.appendChild(text);
      });
    }

    // Emotion select
    function selectEmotion(emo) {
      selectedEmotion = emo;
      wheelEl.style.display = 'none';
      spaceEl.style.display = 'flex';
      startPresence();
    }

    // Set up presence
    function startPresence() {
      const baseRef = db.ref(`presence/${selectedEmotion}`);
      presenceRef = baseRef.child(userId);
      const hue = Math.floor(Math.random()*360);
      const color = `hsl(${hue},70%,80%)`;
      presenceRef.set({ color });
      presenceRef.onDisconnect().remove();

      baseRef.on('value', snap => drawDots(snap.val()));
    }

    // Render dots
    function drawDots(data) {
      // remove old
      spaceArea.querySelectorAll('.dot').forEach(d=>d.remove());
      const width = spaceArea.clientWidth;
      const r = width/2;
      if(!data) return;
      Object.entries(data).forEach(([id,info]) => {
        const dot = document.createElement('div');
        dot.className = 'dot';
        // random position in circle
        let x, y;
        do {
          x = Math.random()*width;
          y = Math.random()*width;
        } while(((x-r)**2 + (y-r)**2) > (r-10)**2);
        dot.style.left = `${x-5}px`;
        dot.style.top = `${y-5}px`;
        dot.style.background = (id===userId ? '#333' : info.color);
        spaceArea.appendChild(dot);
      });
    }

    // Initialize
    resetToIntro();
  </script>
</body>
</html>
